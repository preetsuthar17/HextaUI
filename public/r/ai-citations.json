{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ai-citations",
  "type": "registry:component",
  "title": "AI Citations",
  "description": "Display citations and sources with collapsible source previews.",
  "registryDependencies": ["collapsible"],
  "files": [
    {
      "path": "registry/new-york/blocks/ai/ai-citations.tsx",
      "content": "\"use client\";\n\nimport {\n  ChevronDown,\n  ExternalLink,\n  FileText,\n  Globe,\n  Quote,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface CitationSource {\n  id: string;\n  title: string;\n  url: string;\n  domain?: string;\n  snippet?: string;\n  author?: string;\n  publishedAt?: Date;\n  type?: \"web\" | \"document\" | \"paper\" | \"other\";\n}\n\nexport interface Citation {\n  id: string;\n  number: number;\n  sources: CitationSource[];\n  text?: string; // Optional text that was cited\n}\n\nexport interface AICitationsProps {\n  citations: Citation[];\n  className?: string;\n  defaultExpanded?: boolean;\n  showInlineNumbers?: boolean; // Show citation numbers inline in text\n  onSourceClick?: (source: CitationSource) => void;\n}\n\nconst SOURCE_ICONS: Record<\n  NonNullable<CitationSource[\"type\"]>,\n  React.ComponentType<{ className?: string }>\n> = {\n  document: FileText,\n  paper: FileText,\n  web: Globe,\n  other: Globe,\n};\n\nfunction formatDomain(url: string): string {\n  try {\n    const urlObj = new URL(url);\n    return urlObj.hostname.replace(/^www\\./, \"\");\n  } catch {\n    return url;\n  }\n}\n\nfunction formatDate(date: Date): string {\n  // Use consistent format to avoid hydration mismatches\n  const months = [\n    \"Jan\",\n    \"Feb\",\n    \"Mar\",\n    \"Apr\",\n    \"May\",\n    \"Jun\",\n    \"Jul\",\n    \"Aug\",\n    \"Sep\",\n    \"Oct\",\n    \"Nov\",\n    \"Dec\",\n  ];\n  const month = months[date.getMonth()];\n  const day = date.getDate();\n  const year = date.getFullYear();\n  return `${month} ${day}, ${year}`;\n}\n\ninterface CitationNumberProps {\n  number: number;\n  onClick?: () => void;\n  className?: string;\n  asButton?: boolean; // When false, renders as span (for use inside buttons)\n}\n\nfunction CitationNumber({\n  number,\n  onClick,\n  className,\n  asButton = true,\n}: CitationNumberProps) {\n  const baseClassName = cn(\n    \"inline-flex size-5 items-center justify-center rounded-full border bg-primary/10 font-mono font-semibold text-primary text-xs transition-colors\",\n    asButton &&\n      onClick &&\n      \"cursor-pointer hover:bg-primary/20 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2\",\n    !asButton && \"pointer-events-none\",\n    className\n  );\n\n  if (asButton && onClick) {\n    return (\n      <button\n        aria-label={`Citation ${number}`}\n        className={baseClassName}\n        onClick={onClick}\n        type=\"button\"\n      >\n        {number}\n      </button>\n    );\n  }\n\n  return (\n    <span aria-label={`Citation ${number}`} className={baseClassName}>\n      {number}\n    </span>\n  );\n}\n\ninterface SourcePreviewProps {\n  source: CitationSource;\n  citationNumber: number;\n  onSourceClick?: (source: CitationSource) => void;\n}\n\nfunction SourcePreview({\n  source,\n  citationNumber,\n  onSourceClick,\n}: SourcePreviewProps) {\n  const domain = source.domain || formatDomain(source.url);\n  const IconComponent =\n    SOURCE_ICONS[source.type || \"other\"] || SOURCE_ICONS.web;\n\n  return (\n    <div className=\"group flex flex-col gap-2 rounded-lg border bg-card p-4 transition-colors hover:bg-accent\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"flex min-w-0 flex-1 items-start gap-3\">\n          <div className=\"flex size-8 shrink-0 items-center justify-center rounded-lg bg-primary/10\">\n            <IconComponent className=\"size-4 text-primary\" />\n          </div>\n          <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n            <div className=\"flex items-start gap-2\">\n              <h4 className=\"line-clamp-2 font-medium text-sm leading-snug\">\n                {source.title}\n              </h4>\n              <CitationNumber number={citationNumber} />\n            </div>\n            <div className=\"flex flex-wrap items-center gap-2 text-muted-foreground text-xs\">\n              <span className=\"truncate\">{domain}</span>\n              {source.author && (\n                <>\n                  <span aria-hidden=\"true\">•</span>\n                  <span>{source.author}</span>\n                </>\n              )}\n              {source.publishedAt && (\n                <>\n                  <span aria-hidden=\"true\">•</span>\n                  <time dateTime={source.publishedAt.toISOString()}>\n                    {formatDate(source.publishedAt)}\n                  </time>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n        <a\n          aria-label={`Open ${source.title} in new tab`}\n          className=\"flex size-8 shrink-0 items-center justify-center rounded-md border bg-background text-muted-foreground transition-colors hover:bg-accent hover:text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\"\n          href={source.url}\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          <ExternalLink className=\"size-4\" />\n        </a>\n      </div>\n      {source.snippet && (\n        <div className=\"flex gap-2 pl-11\">\n          <Quote className=\"size-3 shrink-0 translate-y-0.5 text-muted-foreground\" />\n          <p className=\"line-clamp-2 text-muted-foreground text-xs leading-relaxed\">\n            {source.snippet}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface CitationItemProps {\n  citation: Citation;\n  onSourceClick?: (source: CitationSource) => void;\n}\n\nfunction CitationItem({ citation, onSourceClick }: CitationItemProps) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  if (citation.sources.length === 0) {\n    return null;\n  }\n\n  const hasMultipleSources = citation.sources.length > 1;\n\n  return (\n    <Collapsible onOpenChange={setIsOpen} open={isOpen}>\n      <div className=\"flex flex-col gap-2\">\n        {hasMultipleSources ? (\n          <CollapsibleTrigger\n            className=\"flex items-center justify-between rounded-lg border bg-card p-3 text-left transition-colors hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\"\n            type=\"button\"\n          >\n            <div className=\"flex items-center gap-3\">\n              <CitationNumber asButton={false} number={citation.number} />\n              <div className=\"flex flex-col\">\n                <span className=\"font-medium text-sm\">\n                  {citation.sources.length} sources\n                </span>\n                {citation.text && (\n                  <span className=\"text-muted-foreground text-xs\">\n                    {citation.text}\n                  </span>\n                )}\n              </div>\n            </div>\n            <ChevronDown\n              className={cn(\n                \"size-4 shrink-0 text-muted-foreground transition-transform motion-safe:duration-200\",\n                isOpen && \"rotate-180\"\n              )}\n            />\n          </CollapsibleTrigger>\n        ) : (\n          <div className=\"flex items-center gap-3 rounded-lg border bg-card p-3\">\n            <CitationNumber number={citation.number} />\n            <div className=\"flex flex-col\">\n              <span className=\"font-medium text-sm\">Source</span>\n              {citation.text && (\n                <span className=\"text-muted-foreground text-xs\">\n                  {citation.text}\n                </span>\n              )}\n            </div>\n          </div>\n        )}\n\n        {hasMultipleSources ? (\n          <CollapsibleContent className=\"overflow-hidden transition-all motion-safe:duration-200 motion-reduce:transition-none\">\n            <div className=\"flex flex-col gap-2 pt-2\">\n              {citation.sources.map((source) => (\n                <SourcePreview\n                  citationNumber={citation.number}\n                  key={source.id}\n                  onSourceClick={onSourceClick}\n                  source={source}\n                />\n              ))}\n            </div>\n          </CollapsibleContent>\n        ) : (\n          <SourcePreview\n            citationNumber={citation.number}\n            onSourceClick={onSourceClick}\n            source={citation.sources[0]}\n          />\n        )}\n      </div>\n    </Collapsible>\n  );\n}\n\ninterface InlineCitationProps {\n  number: number;\n  onClick?: () => void;\n}\n\nfunction InlineCitation({ number, onClick }: InlineCitationProps) {\n  return (\n    <CitationNumber\n      className=\"-top-0.5 relative mx-0.5\"\n      number={number}\n      onClick={onClick}\n    />\n  );\n}\n\nexport default function AICitations({\n  citations,\n  className,\n  defaultExpanded = false,\n  showInlineNumbers = false,\n  onSourceClick,\n}: AICitationsProps) {\n  if (!citations || citations.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={cn(\"flex w-full flex-col gap-3\", className)}>\n      <div className=\"flex items-center gap-2\">\n        <div className=\"flex size-6 items-center justify-center rounded-lg bg-primary/10\">\n          <Quote className=\"size-3.5 text-primary\" />\n        </div>\n        <h3 className=\"font-semibold text-sm\">Sources & Citations</h3>\n        <span className=\"text-muted-foreground text-xs\">\n          ({citations.length})\n        </span>\n      </div>\n\n      <div className=\"flex flex-col gap-3\">\n        {citations.map((citation) => (\n          <CitationItem\n            citation={citation}\n            key={citation.id}\n            onSourceClick={onSourceClick}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n\n// Export helper component for inline citations in text\nexport { InlineCitation, CitationNumber };\n",
      "type": "registry:component"
    }
  ]
}
