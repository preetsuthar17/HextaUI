{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ai-error-handler",
  "type": "registry:ui",
  "title": "AI Error Handler",
  "description": "Display and handle AI errors with retry functionality.",
  "registryDependencies": ["alert", "badge", "button", "separator"],
  "files": [
    {
      "path": "registry/new-york/blocks/ai/ai-error-handler.tsx",
      "content": "\"use client\";\n\nimport {\n  AlertTriangle,\n  ChevronDown,\n  ChevronUp,\n  Loader2,\n  Mail,\n  RefreshCw,\n  X,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface AIError {\n  id: string;\n  type:\n    | \"rate_limit\"\n    | \"network\"\n    | \"api_error\"\n    | \"authentication\"\n    | \"quota_exceeded\"\n    | \"invalid_request\"\n    | \"server_error\"\n    | \"timeout\"\n    | \"unknown\";\n  message: string;\n  details?: string;\n  errorCode?: string;\n  timestamp: Date;\n  retryable?: boolean;\n  retryCount?: number;\n  maxRetries?: number;\n  retryAfter?: Date;\n  suggestedActions?: string[];\n}\n\nexport interface AIErrorHandlerProps {\n  error?: AIError | null;\n  onRetry?: () => Promise<void>;\n  onDismiss?: () => void;\n  onContactSupport?: () => void;\n  className?: string;\n  showDetails?: boolean;\n  autoRetry?: boolean;\n  autoRetryDelay?: number;\n}\n\nfunction getErrorConfig(type: AIError[\"type\"]) {\n  switch (type) {\n    case \"rate_limit\":\n      return {\n        title: \"Rate Limit Exceeded\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Wait a few moments before trying again\",\n          \"Reduce the frequency of your requests\",\n          \"Upgrade your plan for higher rate limits\",\n        ],\n      };\n    case \"network\":\n      return {\n        title: \"Network Error\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Check your internet connection\",\n          \"Try again in a moment\",\n          \"Verify your network settings\",\n        ],\n      };\n    case \"api_error\":\n      return {\n        title: \"API Error\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Try again in a moment\",\n          \"Check if the service is available\",\n          \"Contact support if the issue persists\",\n        ],\n      };\n    case \"authentication\":\n      return {\n        title: \"Authentication Error\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Check your API key\",\n          \"Verify your authentication credentials\",\n          \"Re-authenticate if needed\",\n        ],\n      };\n    case \"quota_exceeded\":\n      return {\n        title: \"Quota Exceeded\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Upgrade your plan for more quota\",\n          \"Wait until your quota resets\",\n          \"Contact support for assistance\",\n        ],\n      };\n    case \"invalid_request\":\n      return {\n        title: \"Invalid Request\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Check your input parameters\",\n          \"Verify the request format\",\n          \"Review the API documentation\",\n        ],\n      };\n    case \"server_error\":\n      return {\n        title: \"Server Error\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Try again in a moment\",\n          \"The issue may be temporary\",\n          \"Contact support if it persists\",\n        ],\n      };\n    case \"timeout\":\n      return {\n        title: \"Request Timeout\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Try again with a shorter request\",\n          \"Check your network connection\",\n          \"Reduce the complexity of your query\",\n        ],\n      };\n    case \"unknown\":\n    default:\n      return {\n        title: \"An Error Occurred\",\n        icon: AlertTriangle,\n        variant: \"destructive\" as const,\n        suggestedActions: [\n          \"Try again in a moment\",\n          \"Contact support if the issue persists\",\n        ],\n      };\n  }\n}\n\nfunction formatTimeUntil(date: Date): string {\n  const now = new Date();\n  const diff = date.getTime() - now.getTime();\n\n  if (diff <= 0) return \"now\";\n\n  const seconds = Math.floor(diff / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n\n  if (hours > 0) return `${hours} hour${hours !== 1 ? \"s\" : \"\"}`;\n  if (minutes > 0) return `${minutes} minute${minutes !== 1 ? \"s\" : \"\"}`;\n  return `${seconds} second${seconds !== 1 ? \"s\" : \"\"}`;\n}\n\nexport default function AIErrorHandler({\n  error,\n  onRetry,\n  onDismiss,\n  onContactSupport,\n  className,\n  showDetails = true,\n  autoRetry = false,\n  autoRetryDelay = 5000,\n}: AIErrorHandlerProps) {\n  const [isRetrying, setIsRetrying] = useState(false);\n  const [showErrorDetails, setShowErrorDetails] = useState(false);\n\n  if (!error) return null;\n\n  const errorConfig = getErrorConfig(error.type);\n  const ErrorIcon = errorConfig.icon;\n  const canRetry = error.retryable !== false && onRetry;\n  const retryAfterText = error.retryAfter\n    ? formatTimeUntil(error.retryAfter)\n    : null;\n\n  const handleRetry = async () => {\n    if (!onRetry) return;\n\n    setIsRetrying(true);\n    try {\n      await onRetry();\n    } finally {\n      setIsRetrying(false);\n    }\n  };\n\n  return (\n    <Alert\n      className={cn(\"w-full\", className)}\n      live=\"assertive\"\n      variant={errorConfig.variant}\n    >\n      <ErrorIcon className=\"size-4\" />\n      <div className=\"flex min-w-0 flex-1 flex-col gap-3\">\n        <div className=\"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between\">\n          <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n            <AlertTitle className=\"wrap-break-word\">\n              {errorConfig.title}\n            </AlertTitle>\n            <AlertDescription className=\"wrap-break-word\">\n              {error.message}\n            </AlertDescription>\n          </div>\n          <div className=\"flex shrink-0 items-center gap-2\">\n            {error.errorCode && (\n              <Badge className=\"shrink-0 text-xs\" variant=\"secondary\">\n                {error.errorCode}\n              </Badge>\n            )}\n            {onDismiss && (\n              <Button\n                aria-label=\"Dismiss error\"\n                onClick={onDismiss}\n                size=\"icon\"\n                type=\"button\"\n                variant=\"ghost\"\n              >\n                <X className=\"size-4\" />\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {showDetails &&\n          (error.details ||\n            error.errorCode ||\n            error.suggestedActions ||\n            errorConfig.suggestedActions) && (\n            <>\n              <Separator />\n              <div className=\"flex flex-col gap-3\">\n                <button\n                  aria-expanded={showErrorDetails}\n                  className=\"flex items-center justify-between text-muted-foreground text-sm hover:text-foreground\"\n                  onClick={() => setShowErrorDetails(!showErrorDetails)}\n                  type=\"button\"\n                >\n                  <span>Error Details</span>\n                  {showErrorDetails ? (\n                    <ChevronUp className=\"size-4\" />\n                  ) : (\n                    <ChevronDown className=\"size-4\" />\n                  )}\n                </button>\n\n                {showErrorDetails && (\n                  <div className=\"flex flex-col gap-3 rounded-lg border bg-muted/30 p-3\">\n                    {error.details && (\n                      <div className=\"flex flex-col gap-1\">\n                        <span className=\"font-medium text-muted-foreground text-xs\">\n                          Details\n                        </span>\n                        <p className=\"wrap-break-word text-sm\">\n                          {error.details}\n                        </p>\n                      </div>\n                    )}\n\n                    {error.errorCode && (\n                      <div className=\"flex flex-col gap-1\">\n                        <span className=\"font-medium text-muted-foreground text-xs\">\n                          Error Code\n                        </span>\n                        <code className=\"rounded bg-background px-2 py-1 text-xs\">\n                          {error.errorCode}\n                        </code>\n                      </div>\n                    )}\n\n                    {(error.suggestedActions ||\n                      errorConfig.suggestedActions) && (\n                      <div className=\"flex flex-col gap-2\">\n                        <span className=\"font-medium text-muted-foreground text-xs\">\n                          Suggested Actions\n                        </span>\n                        <ul className=\"flex flex-col gap-1.5 pl-4\">\n                          {(\n                            error.suggestedActions ||\n                            errorConfig.suggestedActions\n                          )?.map((action, idx) => (\n                            <li\n                              className=\"before:-ml-4 text-muted-foreground text-sm before:absolute before:content-['•']\"\n                              key={idx}\n                            >\n                              {action}\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n                    )}\n\n                    {error.retryCount !== undefined &&\n                      error.maxRetries !== undefined && (\n                        <div className=\"flex flex-col gap-1\">\n                          <span className=\"font-medium text-muted-foreground text-xs\">\n                            Retry Attempts\n                          </span>\n                          <p className=\"text-sm\">\n                            {error.retryCount} / {error.maxRetries}\n                          </p>\n                        </div>\n                      )}\n\n                    {error.retryAfter && (\n                      <div className=\"flex flex-col gap-1\">\n                        <span className=\"font-medium text-muted-foreground text-xs\">\n                          Retry Available\n                        </span>\n                        <p className=\"text-sm\">In {retryAfterText}</p>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n\n        <Separator />\n\n        <div className=\"flex flex-col gap-2 sm:flex-row\">\n          {canRetry && (\n            <Button\n              aria-busy={isRetrying}\n              className=\"w-full sm:w-auto\"\n              data-loading={isRetrying}\n              disabled={\n                isRetrying ||\n                (error.retryAfter && error.retryAfter > new Date())\n              }\n              onClick={handleRetry}\n              type=\"button\"\n            >\n              {isRetrying ? (\n                <>\n                  <Loader2 className=\"size-4 animate-spin\" />\n                  Retrying…\n                </>\n              ) : (\n                <>\n                  <RefreshCw className=\"size-4\" />\n                  Retry\n                </>\n              )}\n            </Button>\n          )}\n          {onContactSupport && (\n            <Button\n              className=\"w-full sm:w-auto\"\n              onClick={onContactSupport}\n              type=\"button\"\n              variant=\"outline\"\n            >\n              <Mail className=\"size-4\" />\n              Contact Support\n            </Button>\n          )}\n        </div>\n      </div>\n    </Alert>\n  );\n}\n",
      "type": "registry:ui"
    }
  ]
}
