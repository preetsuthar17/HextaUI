{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "auth-email-change",
  "type": "registry:ui",
  "title": "Auth Email Change",
  "description": "Change email address with password verification.",
  "registryDependencies": ["button", "card", "field", "input-group"],
  "files": [
    {
      "path": "registry/new-york/blocks/auth/auth-email-change.tsx",
      "content": "\"use client\";\n\nimport { CheckCircle2, Eye, EyeOff, Loader2, Mail, Shield } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Field,\n  FieldContent,\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupInput,\n} from \"@/components/ui/input-group\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface AuthEmailChangeProps {\n  currentEmail?: string;\n  onSubmit?: (data: { newEmail: string; password: string }) => void;\n  className?: string;\n  isLoading?: boolean;\n  isSuccess?: boolean;\n  errors?: {\n    newEmail?: string;\n    password?: string;\n    general?: string;\n  };\n  successMessage?: string;\n}\n\nexport default function AuthEmailChange({\n  currentEmail,\n  onSubmit,\n  className,\n  isLoading = false,\n  isSuccess = false,\n  errors,\n  successMessage = \"We've sent a verification link to your new email address.\",\n}: AuthEmailChangeProps) {\n  const [newEmail, setNewEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [localErrors, setLocalErrors] = useState<{\n    newEmail?: string;\n    password?: string;\n  }>({});\n\n  const validateEmail = (value: string): string | undefined => {\n    if (!value.trim()) {\n      return \"Email is required\";\n    }\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(value)) {\n      return \"Please enter a valid email address\";\n    }\n    if (value.trim().toLowerCase() === currentEmail?.toLowerCase()) {\n      return \"New email must be different from current email\";\n    }\n    return;\n  };\n\n  const validatePassword = (value: string): string | undefined => {\n    if (!value) {\n      return \"Password is required\";\n    }\n    return;\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const newEmailError = validateEmail(newEmail);\n    const passwordError = validatePassword(password);\n\n    if (newEmailError || passwordError) {\n      setLocalErrors({\n        newEmail: newEmailError,\n        password: passwordError,\n      });\n      return;\n    }\n\n    setLocalErrors({});\n    onSubmit?.({\n      newEmail: newEmail.trim(),\n      password,\n    });\n  };\n\n  const handleNewEmailChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    setNewEmail(value);\n    if (localErrors.newEmail) {\n      setLocalErrors((prev) => ({\n        ...prev,\n        newEmail: validateEmail(value),\n      }));\n    }\n  };\n\n  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    setPassword(value);\n    if (localErrors.password) {\n      setLocalErrors((prev) => ({\n        ...prev,\n        password: validatePassword(value),\n      }));\n    }\n  };\n\n  const newEmailError = errors?.newEmail || localErrors.newEmail;\n  const passwordError = errors?.password || localErrors.password;\n  const generalError = errors?.general;\n\n  if (isSuccess) {\n    return (\n      <Card className={cn(\"w-full shadow-xs\", className)}>\n        <CardHeader>\n          <CardTitle>Verification email sent</CardTitle>\n          <CardDescription>\n            Check your new email address to verify the change\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col items-center gap-4 rounded-lg border border-primary/20 bg-primary/5 p-6 text-center\">\n            <div className=\"flex size-16 items-center justify-center rounded-full bg-primary/10\">\n              <CheckCircle2 className=\"size-8 text-primary\" />\n            </div>\n            <div className=\"flex flex-col gap-2\">\n              <p className=\"font-medium text-sm\">{successMessage}</p>\n              {newEmail && (\n                <p className=\"text-muted-foreground text-sm\">\n                  Sent to <span className=\"font-medium\">{newEmail}</span>\n                </p>\n              )}\n              <p className=\"text-muted-foreground text-xs\">\n                Click the verification link in the email to complete the change.\n                If you don&apos;t see it, check your spam folder.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={cn(\"w-full shadow-xs\", className)}>\n      <CardHeader>\n        <CardTitle>Change email address</CardTitle>\n        <CardDescription>\n          Update your email address. We&apos;ll send a verification link to your\n          new email.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form className=\"flex flex-col gap-6\" onSubmit={handleSubmit}>\n          {generalError && (\n            <div\n              aria-live=\"polite\"\n              className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-destructive text-sm\"\n              role=\"alert\"\n            >\n              {generalError}\n            </div>\n          )}\n\n          {currentEmail && (\n            <div className=\"rounded-lg border bg-muted/50 p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Mail className=\"size-4 text-muted-foreground\" />\n                <div className=\"flex flex-col gap-0.5\">\n                  <span className=\"text-muted-foreground text-xs\">\n                    Current email\n                  </span>\n                  <span className=\"font-medium text-sm\">{currentEmail}</span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex flex-col gap-4\">\n            <Field data-invalid={!!newEmailError}>\n              <FieldLabel htmlFor=\"email-change-new\">\n                New email address\n                <span aria-label=\"required\" className=\"text-destructive\">\n                  *\n                </span>\n              </FieldLabel>\n              <FieldContent>\n                <InputGroup aria-invalid={!!newEmailError}>\n                  <InputGroupAddon>\n                    <Mail className=\"size-4\" />\n                  </InputGroupAddon>\n                  <InputGroupInput\n                    aria-describedby={\n                      newEmailError ? \"email-change-new-error\" : undefined\n                    }\n                    aria-invalid={!!newEmailError}\n                    autoComplete=\"email\"\n                    id=\"email-change-new\"\n                    inputMode=\"email\"\n                    name=\"newEmail\"\n                    onChange={handleNewEmailChange}\n                    placeholder=\"new@example.com\"\n                    required\n                    type=\"email\"\n                    value={newEmail}\n                  />\n                </InputGroup>\n                {newEmailError && (\n                  <FieldError id=\"email-change-new-error\">\n                    {newEmailError}\n                  </FieldError>\n                )}\n                <FieldDescription>\n                  We&apos;ll send a verification link to this address\n                </FieldDescription>\n              </FieldContent>\n            </Field>\n\n            <Field data-invalid={!!passwordError}>\n              <FieldLabel htmlFor=\"email-change-password\">\n                Password\n                <span aria-label=\"required\" className=\"text-destructive\">\n                  *\n                </span>\n              </FieldLabel>\n              <FieldContent>\n                <InputGroup aria-invalid={!!passwordError}>\n                  <InputGroupAddon>\n                    <Shield className=\"size-4\" />\n                  </InputGroupAddon>\n                  <InputGroupInput\n                    aria-describedby={\n                      passwordError ? \"email-change-password-error\" : undefined\n                    }\n                    aria-invalid={!!passwordError}\n                    autoComplete=\"current-password\"\n                    id=\"email-change-password\"\n                    name=\"password\"\n                    onChange={handlePasswordChange}\n                    placeholder=\"Enter your password\"\n                    required\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={password}\n                  />\n                  <InputGroupButton\n                    aria-label={\n                      showPassword ? \"Hide password\" : \"Show password\"\n                    }\n                    onClick={(e) => {\n                      e.preventDefault();\n                      setShowPassword((prev) => !prev);\n                    }}\n                    type=\"button\"\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"size-4\" />\n                    ) : (\n                      <Eye className=\"size-4\" />\n                    )}\n                  </InputGroupButton>\n                </InputGroup>\n                {passwordError && (\n                  <FieldError id=\"email-change-password-error\">\n                    {passwordError}\n                  </FieldError>\n                )}\n                <FieldDescription>\n                  Enter your current password to confirm this change\n                </FieldDescription>\n              </FieldContent>\n            </Field>\n          </div>\n\n          <Button\n            aria-busy={isLoading}\n            className=\"w-full\"\n            data-loading={isLoading}\n            disabled={isLoading}\n            type=\"submit\"\n          >\n            {isLoading ? (\n              <>\n                <Loader2 className=\"size-4 animate-spin\" />\n                Sending verification emailâ€¦\n              </>\n            ) : (\n              <>\n                <Mail className=\"size-4\" />\n                Change email address\n              </>\n            )}\n          </Button>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:ui"
    }
  ]
}
