{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ai-chat-history",
  "type": "registry:component",
  "title": "AI Chat History",
  "description": "Display and manage conversation history with search and filtering.",
  "registryDependencies": [
    "button",
    "card",
    "dropdown-menu",
    "input-group",
    "separator"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/ai/ai-chat-history.tsx",
      "content": "\"use client\";\n\nimport {\n  Archive,\n  MessageSquare,\n  MoreVertical,\n  Pencil,\n  Plus,\n  Search,\n  Trash2,\n  X,\n} from \"lucide-react\";\nimport { useMemo, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupInput,\n} from \"@/components/ui/input-group\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface Conversation {\n  id: string;\n  title: string;\n  lastMessage?: string;\n  lastMessageAt?: Date;\n  messageCount?: number;\n  isArchived?: boolean;\n  isActive?: boolean;\n}\n\nexport interface AIChatHistoryProps {\n  conversations: Conversation[];\n  activeConversationId?: string;\n  onSelect?: (conversationId: string) => void;\n  onNewConversation?: () => void;\n  onRename?: (conversationId: string, newTitle: string) => Promise<void>;\n  onDelete?: (conversationId: string) => Promise<void>;\n  onArchive?: (conversationId: string) => Promise<void>;\n  onUnarchive?: (conversationId: string) => Promise<void>;\n  className?: string;\n  showSearch?: boolean;\n  showNewButton?: boolean;\n}\n\nfunction formatDate(date: Date): string {\n  const now = new Date();\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n  const thisWeek = new Date(today);\n  thisWeek.setDate(thisWeek.getDate() - 7);\n\n  const dateOnly = new Date(\n    date.getFullYear(),\n    date.getMonth(),\n    date.getDate()\n  );\n\n  if (dateOnly.getTime() === today.getTime()) {\n    return \"Today\";\n  }\n  if (dateOnly.getTime() === yesterday.getTime()) {\n    return \"Yesterday\";\n  }\n  if (dateOnly.getTime() >= thisWeek.getTime()) {\n    return \"This Week\";\n  }\n\n  const month = date.toLocaleString(\"en-US\", { month: \"short\" });\n  const day = date.getDate();\n  const year = date.getFullYear();\n  const currentYear = now.getFullYear();\n\n  if (year === currentYear) {\n    return `${month} ${day}`;\n  }\n  return `${month} ${day}, ${year}`;\n}\n\nfunction groupConversationsByDate(conversations: Conversation[]): {\n  label: string;\n  conversations: Conversation[];\n}[] {\n  const groups: Record<string, Conversation[]> = {};\n\n  conversations.forEach((conv) => {\n    if (!conv.lastMessageAt) {\n      if (!groups[\"Older\"]) {\n        groups[\"Older\"] = [];\n      }\n      groups[\"Older\"].push(conv);\n      return;\n    }\n\n    const label = formatDate(conv.lastMessageAt);\n    if (!groups[label]) {\n      groups[label] = [];\n    }\n    groups[label].push(conv);\n  });\n\n  const orderedLabels = [\"Today\", \"Yesterday\", \"This Week\"];\n  const result: { label: string; conversations: Conversation[] }[] = [];\n\n  orderedLabels.forEach((label) => {\n    if (groups[label]) {\n      result.push({ label, conversations: groups[label] });\n      delete groups[label];\n    }\n  });\n\n  Object.keys(groups)\n    .sort()\n    .forEach((label) => {\n      result.push({ label, conversations: groups[label] });\n    });\n\n  if (groups[\"Older\"]) {\n    result.push({ label: \"Older\", conversations: groups[\"Older\"] });\n  }\n\n  return result;\n}\n\nexport default function AIChatHistory({\n  conversations,\n  activeConversationId,\n  onSelect,\n  onNewConversation,\n  onRename,\n  onDelete,\n  onArchive,\n  onUnarchive,\n  className,\n  showSearch = true,\n  showNewButton = true,\n}: AIChatHistoryProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editValue, setEditValue] = useState(\"\");\n\n  const filteredConversations = useMemo(() => {\n    if (!searchQuery.trim()) return conversations;\n\n    const query = searchQuery.toLowerCase();\n    return conversations.filter(\n      (conv) =>\n        conv.title.toLowerCase().includes(query) ||\n        conv.lastMessage?.toLowerCase().includes(query)\n    );\n  }, [conversations, searchQuery]);\n\n  const groupedConversations = useMemo(\n    () => groupConversationsByDate(filteredConversations),\n    [filteredConversations]\n  );\n\n  const handleRenameStart = (conversation: Conversation) => {\n    setEditingId(conversation.id);\n    setEditValue(conversation.title);\n  };\n\n  const handleRenameSubmit = async (conversationId: string) => {\n    if (!(onRename && editValue.trim())) {\n      setEditingId(null);\n      return;\n    }\n\n    await onRename(conversationId, editValue.trim());\n    setEditingId(null);\n  };\n\n  const handleRenameCancel = () => {\n    setEditingId(null);\n    setEditValue(\"\");\n  };\n\n  return (\n    <Card className={cn(\"flex h-fit flex-col shadow-xs\", className)}>\n      <CardHeader className=\"shrink-0\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex flex-wrap items-center justify-between gap-3\">\n            <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n              <CardTitle>Conversations</CardTitle>\n              <CardDescription>\n                {conversations.length} conversation\n                {conversations.length !== 1 ? \"s\" : \"\"}\n              </CardDescription>\n            </div>\n            {showNewButton && onNewConversation && (\n              <Button\n                className=\"w-full shrink-0\"\n                onClick={onNewConversation}\n                type=\"button\"\n              >\n                <Plus className=\"size-4\" />\n                <span className=\"whitespace-nowrap\">New Chat</span>\n              </Button>\n            )}\n          </div>\n          {showSearch && (\n            <InputGroup>\n              <InputGroupAddon>\n                <Search className=\"size-4\" />\n              </InputGroupAddon>\n              <InputGroupInput\n                onChange={(e) => setSearchQuery(e.target.value)}\n                placeholder=\"Search conversations…\"\n                type=\"search\"\n                value={searchQuery}\n              />\n              {searchQuery && (\n                <Button\n                  aria-label=\"Clear search\"\n                  className=\"-translate-y-1/2 absolute top-1/2 right-2\"\n                  onClick={() => setSearchQuery(\"\")}\n                  size=\"icon\"\n                  type=\"button\"\n                  variant=\"ghost\"\n                >\n                  <X className=\"size-4\" />\n                </Button>\n              )}\n            </InputGroup>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex min-h-0 flex-1 flex-col gap-0 overflow-y-auto\">\n        {filteredConversations.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center gap-4 py-12 text-center\">\n            <div className=\"flex size-12 items-center justify-center rounded-full bg-muted\">\n              <MessageSquare className=\"size-6 text-muted-foreground\" />\n            </div>\n            <div className=\"flex flex-col gap-2\">\n              <p className=\"font-medium text-sm\">\n                {searchQuery ? \"No conversations found\" : \"No conversations\"}\n              </p>\n              <p className=\"text-muted-foreground text-sm\">\n                {searchQuery\n                  ? \"Try a different search term\"\n                  : \"Start a new conversation to get started\"}\n              </p>\n            </div>\n            {!searchQuery && showNewButton && onNewConversation && (\n              <Button\n                onClick={onNewConversation}\n                type=\"button\"\n                variant=\"outline\"\n              >\n                <Plus className=\"size-4\" />\n                New Conversation\n              </Button>\n            )}\n          </div>\n        ) : (\n          <div className=\"flex flex-col gap-4\">\n            {groupedConversations.map((group, groupIdx) => (\n              <div key={group.label}>\n                <div className=\"sticky top-0 z-10 bg-card py-2\">\n                  <h3 className=\"font-medium text-muted-foreground text-xs uppercase tracking-wider\">\n                    {group.label}\n                  </h3>\n                </div>\n                <div className=\"flex flex-col gap-1\">\n                  {group.conversations.map((conversation, idx) => {\n                    const isActive = conversation.id === activeConversationId;\n                    const isEditing = editingId === conversation.id;\n\n                    return (\n                      <div\n                        className={cn(\n                          \"group relative flex flex-col gap-2 rounded-lg border p-3 transition-colors\",\n                          isActive\n                            ? \"border-primary bg-primary/5\"\n                            : \"border-transparent bg-card hover:border-border hover:bg-muted/50\"\n                        )}\n                        key={conversation.id}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <button\n                            aria-label={`Select conversation ${conversation.title}`}\n                            className=\"flex min-w-0 flex-1 flex-col gap-1 text-left\"\n                            onClick={() => onSelect?.(conversation.id)}\n                            type=\"button\"\n                          >\n                            {isEditing ? (\n                              <input\n                                autoFocus\n                                className=\"w-full rounded-md border bg-background px-2 py-1 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\"\n                                onBlur={() =>\n                                  handleRenameSubmit(conversation.id)\n                                }\n                                onChange={(e) => setEditValue(e.target.value)}\n                                onKeyDown={(e) => {\n                                  if (e.key === \"Enter\") {\n                                    handleRenameSubmit(conversation.id);\n                                  } else if (e.key === \"Escape\") {\n                                    handleRenameCancel();\n                                  }\n                                }}\n                                value={editValue}\n                              />\n                            ) : (\n                              <>\n                                <div className=\"flex flex-wrap items-center gap-2\">\n                                  <h4 className=\"wrap-break-word min-w-0 font-medium text-sm\">\n                                    {conversation.title}\n                                  </h4>\n                                </div>\n                                {conversation.lastMessage && (\n                                  <p className=\"wrap-break-word line-clamp-2 min-w-0 text-muted-foreground text-xs\">\n                                    {conversation.lastMessage}\n                                  </p>\n                                )}\n                                <div className=\"flex flex-wrap items-center gap-2 text-muted-foreground text-xs\">\n                                  {conversation.lastMessageAt && (\n                                    <span className=\"whitespace-nowrap\">\n                                      {formatDate(conversation.lastMessageAt)}\n                                    </span>\n                                  )}\n                                  {conversation.messageCount !== undefined && (\n                                    <>\n                                      <span\n                                        aria-hidden=\"true\"\n                                        className=\"shrink-0\"\n                                      >\n                                        •\n                                      </span>\n                                      <span className=\"whitespace-nowrap\">\n                                        {conversation.messageCount} message\n                                        {conversation.messageCount !== 1\n                                          ? \"s\"\n                                          : \"\"}\n                                      </span>\n                                    </>\n                                  )}\n                                </div>\n                              </>\n                            )}\n                          </button>\n                          {!isEditing && (\n                            <DropdownMenu>\n                              <DropdownMenuTrigger asChild>\n                                <Button\n                                  aria-label={`More options for ${conversation.title}`}\n                                  className=\"shrink-0 opacity-0 transition-opacity group-hover:opacity-100\"\n                                  size=\"icon\"\n                                  type=\"button\"\n                                  variant=\"ghost\"\n                                >\n                                  <MoreVertical className=\"size-4\" />\n                                </Button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent align=\"end\">\n                                {onRename && (\n                                  <DropdownMenuItem\n                                    onClick={() =>\n                                      handleRenameStart(conversation)\n                                    }\n                                  >\n                                    <Pencil className=\"size-4\" />\n                                    Rename\n                                  </DropdownMenuItem>\n                                )}\n                                <DropdownMenuSeparator />\n                                {conversation.isArchived\n                                  ? onUnarchive && (\n                                      <DropdownMenuItem\n                                        onClick={() =>\n                                          onUnarchive(conversation.id)\n                                        }\n                                      >\n                                        <Archive className=\"size-4\" />\n                                        Unarchive\n                                      </DropdownMenuItem>\n                                    )\n                                  : onArchive && (\n                                      <DropdownMenuItem\n                                        onClick={() =>\n                                          onArchive(conversation.id)\n                                        }\n                                      >\n                                        <Archive className=\"size-4\" />\n                                        Archive\n                                      </DropdownMenuItem>\n                                    )}\n                                {onDelete && (\n                                  <>\n                                    <DropdownMenuSeparator />\n                                    <DropdownMenuItem\n                                      onClick={() => onDelete(conversation.id)}\n                                      variant=\"destructive\"\n                                    >\n                                      <Trash2 className=\"size-4\" />\n                                      Delete\n                                    </DropdownMenuItem>\n                                  </>\n                                )}\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n                {groupIdx < groupedConversations.length - 1 && (\n                  <Separator className=\"my-4\" />\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}
