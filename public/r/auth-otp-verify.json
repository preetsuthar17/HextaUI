{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "auth-otp-verify",
  "type": "registry:ui",
  "title": "Auth OTP Verify",
  "description": "Verify OTP code sent via email, SMS, or WhatsApp.",
  "registryDependencies": ["button", "card", "field", "input-otp", "select"],
  "files": [
    {
      "path": "registry/new-york/blocks/auth/auth-otp-verify.tsx",
      "content": "\"use client\";\n\nimport { Loader2, Mail, MessageSquare, Phone, RefreshCw } from \"lucide-react\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/registry/new-york/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/registry/new-york/ui/card\";\nimport {\n  Field,\n  FieldContent,\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n} from \"@/registry/new-york/ui/field\";\nimport {\n  InputOTP,\n  InputOTPGroup,\n  InputOTPSlot,\n} from \"@/registry/new-york/ui/input-otp\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/registry/new-york/ui/select\";\n\nexport type OTPDeliveryMethod = \"email\" | \"sms\" | \"whatsapp\";\n\nexport interface AuthOTPVerifyProps {\n  deliveryMethod?: OTPDeliveryMethod;\n  deliveryAddress?: string; // email or phone number\n  onDeliveryMethodChange?: (method: OTPDeliveryMethod) => void;\n  onSubmit?: (code: string) => void;\n  onResend?: (method: OTPDeliveryMethod) => void;\n  className?: string;\n  isLoading?: boolean;\n  resendCooldown?: number; // seconds\n  errors?: {\n    code?: string;\n    general?: string;\n  };\n  autoSubmit?: boolean;\n  codeLength?: number;\n  availableMethods?: OTPDeliveryMethod[];\n}\n\nconst DELIVERY_METHOD_CONFIG: Record<\n  OTPDeliveryMethod,\n  { label: string; icon: React.ComponentType<{ className?: string }> }\n> = {\n  email: {\n    label: \"Email\",\n    icon: Mail,\n  },\n  sms: {\n    label: \"SMS\",\n    icon: MessageSquare,\n  },\n  whatsapp: {\n    label: \"WhatsApp\",\n    icon: Phone,\n  },\n};\n\nexport default function AuthOTPVerify({\n  deliveryMethod = \"email\",\n  deliveryAddress,\n  onDeliveryMethodChange,\n  onSubmit,\n  onResend,\n  className,\n  isLoading = false,\n  resendCooldown = 60,\n  errors,\n  autoSubmit = true,\n  codeLength = 6,\n  availableMethods = [\"email\", \"sms\"],\n}: AuthOTPVerifyProps) {\n  const [code, setCode] = useState(\"\");\n  const [cooldown, setCooldown] = useState(0);\n\n  useEffect(() => {\n    if (cooldown > 0) {\n      const timer = setTimeout(() => {\n        setCooldown((prev) => prev - 1);\n      }, 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [cooldown]);\n\n  useEffect(() => {\n    if (autoSubmit && code.length === codeLength && !isLoading) {\n      onSubmit?.(code);\n    }\n  }, [code, autoSubmit, isLoading, codeLength, onSubmit]);\n\n  const handleResend = useCallback(async () => {\n    if (cooldown > 0) return;\n    await onResend?.(deliveryMethod);\n    setCooldown(resendCooldown);\n  }, [cooldown, onResend, deliveryMethod, resendCooldown]);\n\n  const codeError = errors?.code;\n  const generalError = errors?.general;\n  const methodConfig = DELIVERY_METHOD_CONFIG[deliveryMethod];\n  const MethodIcon = methodConfig.icon;\n\n  const formatDeliveryAddress = (address?: string): string => {\n    if (!address) return \"\";\n    if (deliveryMethod === \"email\") return address;\n    // Mask phone number: +1 (***) ***-5678\n    if (address.length > 4) {\n      const visible = address.slice(-4);\n      const masked = \"*\".repeat(address.length - 4);\n      return `${masked}${visible}`;\n    }\n    return address;\n  };\n\n  return (\n    <Card className={cn(\"w-full shadow-xs\", className)}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <MethodIcon className=\"size-5\" />\n          Verify your {methodConfig.label.toLowerCase()}\n        </CardTitle>\n        <CardDescription>\n          We&apos;ve sent a {codeLength}-digit code to{\" \"}\n          {deliveryAddress ? (\n            <span className=\"font-medium\">\n              {formatDeliveryAddress(deliveryAddress)}\n            </span>\n          ) : (\n            \"your \" + methodConfig.label.toLowerCase()\n          )}\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col gap-6\">\n          {generalError && (\n            <div\n              aria-live=\"polite\"\n              className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-destructive text-sm\"\n              role=\"alert\"\n            >\n              {generalError}\n            </div>\n          )}\n\n          {availableMethods.length > 1 && onDeliveryMethodChange && (\n            <Field>\n              <FieldLabel>Delivery method</FieldLabel>\n              <FieldContent>\n                <Select\n                  onValueChange={(value) =>\n                    onDeliveryMethodChange(value as OTPDeliveryMethod)\n                  }\n                  value={deliveryMethod}\n                >\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {availableMethods.map((method) => {\n                      const config = DELIVERY_METHOD_CONFIG[method];\n                      const Icon = config.icon;\n                      return (\n                        <SelectItem key={method} value={method}>\n                          <div className=\"flex items-center gap-2\">\n                            <Icon className=\"size-4\" />\n                            {config.label}\n                          </div>\n                        </SelectItem>\n                      );\n                    })}\n                  </SelectContent>\n                </Select>\n                <FieldDescription>\n                  Choose how you want to receive the verification code\n                </FieldDescription>\n              </FieldContent>\n            </Field>\n          )}\n\n          <Field data-invalid={!!codeError}>\n            <FieldLabel htmlFor=\"otp-code\">\n              Verification code\n              <span aria-label=\"required\" className=\"text-destructive\">\n                *\n              </span>\n            </FieldLabel>\n            <FieldContent>\n              <InputOTP\n                aria-describedby={codeError ? \"otp-code-error\" : undefined}\n                aria-invalid={!!codeError}\n                disabled={isLoading}\n                id=\"otp-code\"\n                maxLength={codeLength}\n                onChange={setCode}\n                value={code}\n              >\n                <InputOTPGroup>\n                  {Array.from({ length: codeLength }).map((_, index) => (\n                    <InputOTPSlot index={index} key={index} />\n                  ))}\n                </InputOTPGroup>\n              </InputOTP>\n              {codeError && (\n                <FieldError id=\"otp-code-error\">{codeError}</FieldError>\n              )}\n              <div className=\"flex flex-col gap-2 text-muted-foreground text-xs sm:flex-row sm:items-center sm:justify-between\">\n                <span>Enter the {codeLength}-digit code</span>\n                {onResend && (\n                  <button\n                    className=\"self-start rounded-sm hover:text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 sm:self-auto\"\n                    disabled={cooldown > 0 || isLoading}\n                    onClick={handleResend}\n                    type=\"button\"\n                  >\n                    {cooldown > 0 ? (\n                      `Resend in ${cooldown}s`\n                    ) : (\n                      <span className=\"flex items-center gap-1\">\n                        <RefreshCw className=\"size-3\" />\n                        Resend code\n                      </span>\n                    )}\n                  </button>\n                )}\n              </div>\n            </FieldContent>\n          </Field>\n\n          {!autoSubmit && (\n            <Button\n              aria-busy={isLoading}\n              className=\"w-full\"\n              data-loading={isLoading}\n              disabled={isLoading || code.length !== codeLength}\n              onClick={() => onSubmit?.(code)}\n              type=\"button\"\n            >\n              {isLoading ? (\n                <>\n                  <Loader2 className=\"size-4 animate-spin\" />\n                  Verifyingâ€¦\n                </>\n              ) : (\n                \"Verify code\"\n              )}\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:ui"
    }
  ]
}
