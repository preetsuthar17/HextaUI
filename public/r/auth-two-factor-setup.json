{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "auth-two-factor-setup",
  "type": "registry:ui",
  "title": "Auth Two Factor Setup",
  "description": "Set up two-factor authentication with QR code and backup codes.",
  "dependencies": ["next"],
  "registryDependencies": [
    "button",
    "card",
    "field",
    "input-group",
    "separator",
    "switch"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/auth/auth-two-factor-setup.tsx",
      "content": "\"use client\";\n\nimport {\n  CheckCircle2,\n  Copy,\n  Download,\n  Eye,\n  EyeOff,\n  Loader2,\n  QrCode,\n  RefreshCw,\n  Shield,\n  ShieldCheck,\n  ShieldOff,\n} from \"lucide-react\";\nimport Image from \"next/image\";\nimport { useCallback, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Field,\n  FieldContent,\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupInput,\n} from \"@/components/ui/input-group\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface AuthTwoFactorSetupProps {\n  isEnabled?: boolean;\n  qrCodeUrl?: string;\n  secretKey?: string;\n  backupCodes?: string[];\n  onEnable?: () => void;\n  onDisable?: (password: string) => void;\n  onGenerateBackupCodes?: () => void;\n  onRegenerateSecret?: () => void;\n  className?: string;\n  isLoading?: boolean;\n  errors?: {\n    password?: string;\n    general?: string;\n  };\n}\n\nexport default function AuthTwoFactorSetup({\n  isEnabled = false,\n  qrCodeUrl,\n  secretKey,\n  backupCodes = [],\n  onEnable,\n  onDisable,\n  onGenerateBackupCodes,\n  onRegenerateSecret,\n  className,\n  isLoading = false,\n  errors,\n}: AuthTwoFactorSetupProps) {\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showBackupCodes, setShowBackupCodes] = useState(false);\n  const [copiedIndex, setCopiedIndex] = useState<number | null>(null);\n\n  const handleCopyCode = useCallback(async (code: string, index: number) => {\n    try {\n      await navigator.clipboard.writeText(code);\n      setCopiedIndex(index);\n      setTimeout(() => setCopiedIndex(null), 2000);\n    } catch {}\n  }, []);\n\n  const handleCopySecret = useCallback(async () => {\n    if (secretKey) {\n      try {\n        await navigator.clipboard.writeText(secretKey);\n      } catch {}\n    }\n  }, [secretKey]);\n\n  const handleDisable = useCallback(() => {\n    if (!password.trim()) return;\n    onDisable?.(password);\n    setPassword(\"\");\n  }, [password, onDisable]);\n\n  const handleDownloadBackupCodes = useCallback(() => {\n    if (backupCodes.length === 0) return;\n    const content = backupCodes.join(\"\\n\");\n    const blob = new Blob([content], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"backup-codes.txt\";\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }, [backupCodes]);\n\n  if (isEnabled) {\n    return (\n      <Card className={cn(\"w-full max-w-full shadow-xs\", className)}>\n        <CardHeader>\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n            <div className=\"min-w-0 flex-1\">\n              <CardTitle className=\"flex flex-wrap items-center gap-2\">\n                <ShieldCheck className=\"size-5 shrink-0 text-primary\" />\n                <span className=\"wrap-break-word\">\n                  Two-factor authentication\n                </span>\n              </CardTitle>\n              <CardDescription className=\"wrap-break-word\">\n                Your account is protected with 2FA\n              </CardDescription>\n            </div>\n            <div className=\"flex shrink-0 items-center gap-2\">\n              <span className=\"whitespace-nowrap text-muted-foreground text-sm\">\n                Enabled\n              </span>\n              <Switch checked={true} disabled />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col gap-6\">\n            {errors?.general && (\n              <div\n                aria-live=\"polite\"\n                className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-destructive text-sm\"\n                role=\"alert\"\n              >\n                {errors.general}\n              </div>\n            )}\n\n            <div className=\"flex flex-col gap-4\">\n              <div className=\"rounded-lg border bg-muted/50 p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <ShieldCheck className=\"size-5 shrink-0 text-primary\" />\n                  <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n                    <p className=\"wrap-break-word font-medium text-sm\">\n                      2FA is active\n                    </p>\n                    <p className=\"wrap-break-word text-muted-foreground text-xs\">\n                      Your account is protected with two-factor authentication.\n                      You&apos;ll need to enter a code from your authenticator\n                      app when signing in.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {backupCodes.length > 0 && (\n                <div className=\"flex flex-col gap-3\">\n                  <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n                    <div className=\"min-w-0 flex-1\">\n                      <h3 className=\"wrap-break-word font-medium text-sm\">\n                        Backup codes\n                      </h3>\n                      <p className=\"wrap-break-word text-muted-foreground text-xs\">\n                        Save these codes in a safe place. You can use them to\n                        access your account if you lose your device.\n                      </p>\n                    </div>\n                    <Button\n                      className=\"w-full sm:w-auto\"\n                      onClick={() => setShowBackupCodes(!showBackupCodes)}\n                      type=\"button\"\n                      variant=\"outline\"\n                    >\n                      {showBackupCodes ? \"Hide\" : \"Show\"} codes\n                    </Button>\n                  </div>\n                  {showBackupCodes && (\n                    <div className=\"grid grid-cols-1 gap-2 rounded-lg border bg-background p-4 sm:grid-cols-2\">\n                      {backupCodes.map((code, index) => (\n                        <div\n                          className=\"flex min-w-0 items-center justify-between gap-2 font-mono text-sm\"\n                          key={index}\n                        >\n                          <span className=\"min-w-0 break-all\">{code}</span>\n                          <Button\n                            aria-label={`Copy backup code ${index + 1}`}\n                            className=\"shrink-0\"\n                            onClick={() => handleCopyCode(code, index)}\n                            size=\"icon-sm\"\n                            type=\"button\"\n                            variant=\"ghost\"\n                          >\n                            {copiedIndex === index ? (\n                              <CheckCircle2 className=\"size-3.5 text-primary\" />\n                            ) : (\n                              <Copy className=\"size-3.5\" />\n                            )}\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  <div className=\"flex flex-col gap-2 sm:flex-row\">\n                    <Button\n                      className=\"w-full sm:w-auto\"\n                      onClick={handleDownloadBackupCodes}\n                      type=\"button\"\n                      variant=\"outline\"\n                    >\n                      <Download className=\"size-4\" />\n                      Download codes\n                    </Button>\n                    {onGenerateBackupCodes && (\n                      <Button\n                        className=\"w-full sm:w-auto\"\n                        onClick={onGenerateBackupCodes}\n                        type=\"button\"\n                        variant=\"outline\"\n                      >\n                        <RefreshCw className=\"size-4\" />\n                        Regenerate codes\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              <Separator />\n\n              <div className=\"flex flex-col gap-4\">\n                <div className=\"min-w-0\">\n                  <h3 className=\"wrap-break-word font-medium text-destructive text-sm\">\n                    Disable two-factor authentication\n                  </h3>\n                  <p className=\"wrap-break-word text-muted-foreground text-xs\">\n                    You&apos;ll need to enter your password to disable 2FA.\n                  </p>\n                </div>\n                <Field data-invalid={!!errors?.password}>\n                  <FieldLabel htmlFor=\"disable-2fa-password\">\n                    Password\n                    <span aria-label=\"required\" className=\"text-destructive\">\n                      *\n                    </span>\n                  </FieldLabel>\n                  <FieldContent>\n                    <InputGroup aria-invalid={!!errors?.password}>\n                      <InputGroupAddon>\n                        <Shield className=\"size-4\" />\n                      </InputGroupAddon>\n                      <InputGroupInput\n                        aria-describedby={\n                          errors?.password\n                            ? \"disable-2fa-password-error\"\n                            : undefined\n                        }\n                        aria-invalid={!!errors?.password}\n                        autoComplete=\"current-password\"\n                        id=\"disable-2fa-password\"\n                        name=\"password\"\n                        onChange={(e) => setPassword(e.target.value)}\n                        placeholder=\"Enter your password\"\n                        required\n                        type={showPassword ? \"text\" : \"password\"}\n                        value={password}\n                      />\n                      <InputGroupButton\n                        aria-label={\n                          showPassword ? \"Hide password\" : \"Show password\"\n                        }\n                        onClick={(e) => {\n                          e.preventDefault();\n                          setShowPassword((prev) => !prev);\n                        }}\n                        type=\"button\"\n                      >\n                        {showPassword ? (\n                          <EyeOff className=\"size-4\" />\n                        ) : (\n                          <Eye className=\"size-4\" />\n                        )}\n                      </InputGroupButton>\n                    </InputGroup>\n                    {errors?.password && (\n                      <FieldError id=\"disable-2fa-password-error\">\n                        {errors.password}\n                      </FieldError>\n                    )}\n                  </FieldContent>\n                </Field>\n                <Button\n                  aria-busy={isLoading}\n                  className=\"w-full\"\n                  data-loading={isLoading}\n                  disabled={isLoading || !password.trim()}\n                  onClick={handleDisable}\n                  type=\"button\"\n                  variant=\"destructive\"\n                >\n                  {isLoading ? (\n                    <>\n                      <Loader2 className=\"size-4 animate-spin\" />\n                      Disabling…\n                    </>\n                  ) : (\n                    <>\n                      <ShieldOff className=\"size-4\" />\n                      Disable 2FA\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={cn(\"w-full max-w-full shadow-xs\", className)}>\n      <CardHeader>\n        <CardTitle className=\"flex flex-wrap items-center gap-2\">\n          <Shield className=\"size-5 shrink-0\" />\n          <span className=\"wrap-break-word\">\n            Set up two-factor authentication\n          </span>\n        </CardTitle>\n        <CardDescription className=\"wrap-break-word\">\n          Add an extra layer of security to your account\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col gap-6\">\n          {errors?.general && (\n            <div\n              aria-live=\"polite\"\n              className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-destructive text-sm\"\n              role=\"alert\"\n            >\n              {errors.general}\n            </div>\n          )}\n\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"rounded-lg border bg-muted/50 p-4\">\n              <p className=\"wrap-break-word text-muted-foreground text-sm\">\n                Scan the QR code with your authenticator app (like Google\n                Authenticator, Authy, or 1Password) to set up two-factor\n                authentication.\n              </p>\n            </div>\n\n            {qrCodeUrl && (\n              <div className=\"flex flex-col items-center gap-4 rounded-lg border bg-background p-4 sm:p-6\">\n                <div className=\"relative aspect-square w-full max-w-[192px] rounded-lg border bg-white p-3 sm:size-48 sm:p-4\">\n                  <Image\n                    alt=\"QR code for two-factor authentication\"\n                    className=\"object-contain p-4\"\n                    fill\n                    sizes=\"(max-width: 640px) 192px, 192px\"\n                    src={qrCodeUrl}\n                  />\n                </div>\n                <p className=\"text-center text-muted-foreground text-xs\">\n                  Scan this QR code with your authenticator app\n                </p>\n              </div>\n            )}\n\n            {secretKey && (\n              <Field>\n                <FieldLabel>Manual entry key</FieldLabel>\n                <FieldContent>\n                  <InputGroup>\n                    <InputGroupAddon>\n                      <QrCode className=\"size-4\" />\n                    </InputGroupAddon>\n                    <InputGroupInput readOnly type=\"text\" value={secretKey} />\n                    <InputGroupButton\n                      aria-label=\"Copy secret key\"\n                      onClick={handleCopySecret}\n                      type=\"button\"\n                    >\n                      <Copy className=\"size-4\" />\n                    </InputGroupButton>\n                  </InputGroup>\n                  <FieldDescription>\n                    If you can&apos;t scan the QR code, enter this key manually\n                    in your authenticator app\n                  </FieldDescription>\n                </FieldContent>\n              </Field>\n            )}\n\n            {onRegenerateSecret && (\n              <Button\n                className=\"w-full sm:w-auto\"\n                onClick={onRegenerateSecret}\n                type=\"button\"\n                variant=\"outline\"\n              >\n                <RefreshCw className=\"size-4\" />\n                Generate new QR code\n              </Button>\n            )}\n\n            <Separator />\n\n            <div className=\"flex flex-col gap-2\">\n              <Button\n                aria-busy={isLoading}\n                className=\"w-full\"\n                data-loading={isLoading}\n                disabled={isLoading}\n                onClick={onEnable}\n                type=\"button\"\n              >\n                {isLoading ? (\n                  <>\n                    <Loader2 className=\"size-4 animate-spin\" />\n                    Enabling 2FA…\n                  </>\n                ) : (\n                  <>\n                    <ShieldCheck className=\"size-4\" />\n                    Enable 2FA\n                  </>\n                )}\n              </Button>\n              <p className=\"text-center text-muted-foreground text-xs\">\n                After enabling, you&apos;ll need to verify with a code from your\n                authenticator app\n              </p>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:ui"
    }
  ]
}
