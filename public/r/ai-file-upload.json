{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ai-file-upload",
  "type": "registry:component",
  "title": "AI File Upload",
  "description": "Upload files for AI analysis with drag and drop support.",
  "registryDependencies": ["button", "card", "progress"],
  "files": [
    {
      "path": "registry/new-york/blocks/ai/ai-file-upload.tsx",
      "content": "\"use client\";\n\nimport {\n  Check,\n  File,\n  FileImage,\n  FileText,\n  Loader2,\n  Upload,\n  X,\n} from \"lucide-react\";\nimport Image from \"next/image\";\nimport { useCallback, useRef, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface UploadedFile {\n  id: string;\n  file: File;\n  preview?: string;\n  status: \"uploading\" | \"processing\" | \"completed\" | \"error\";\n  progress?: number;\n  error?: string;\n}\n\nexport interface AIFileUploadProps {\n  onFilesSelected?: (files: File[]) => void;\n  onFileRemove?: (fileId: string) => void;\n  uploadedFiles?: UploadedFile[];\n  acceptedTypes?: string[];\n  maxSize?: number;\n  maxFiles?: number;\n  className?: string;\n  showPreview?: boolean;\n  processingStatus?: Record<string, \"processing\" | \"completed\" | \"error\">;\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return \"0 Bytes\";\n  const k = 1024;\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${Math.round((bytes / k ** i) * 100) / 100} ${sizes[i]}`;\n}\n\nfunction getFileIcon(type: string) {\n  if (type.startsWith(\"image/\")) {\n    return FileImage;\n  }\n  if (\n    type.includes(\"text\") ||\n    type.includes(\"document\") ||\n    type.includes(\"pdf\")\n  ) {\n    return FileText;\n  }\n  return File;\n}\n\nfunction getFileTypeLabel(type: string): string {\n  if (type.startsWith(\"image/\")) {\n    return \"Image\";\n  }\n  if (type.includes(\"pdf\")) {\n    return \"PDF\";\n  }\n  if (type.includes(\"text\")) {\n    return \"Text\";\n  }\n  if (\n    type.includes(\"code\") ||\n    type.includes(\"javascript\") ||\n    type.includes(\"typescript\")\n  ) {\n    return \"Code\";\n  }\n  return \"File\";\n}\n\nexport default function AIFileUpload({\n  onFilesSelected,\n  onFileRemove,\n  uploadedFiles = [],\n  acceptedTypes = [\"image/*\", \"application/pdf\", \"text/*\"],\n  maxSize = 10 * 1024 * 1024,\n  maxFiles = 10,\n  className,\n  showPreview = true,\n  processingStatus,\n}: AIFileUploadProps) {\n  const [isDragging, setIsDragging] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const validateFile = useCallback(\n    (file: File): string | null => {\n      if (maxSize && file.size > maxSize) {\n        return `File size exceeds ${formatFileSize(maxSize)}`;\n      }\n\n      if (acceptedTypes.length > 0) {\n        const isAccepted = acceptedTypes.some((type) => {\n          if (type.endsWith(\"/*\")) {\n            return file.type.startsWith(type.slice(0, -2));\n          }\n          return file.type === type;\n        });\n\n        if (!isAccepted) {\n          return `File type not supported. Accepted types: ${acceptedTypes.join(\", \")}`;\n        }\n      }\n\n      return null;\n    },\n    [maxSize, acceptedTypes]\n  );\n\n  const handleFiles = useCallback(\n    (files: FileList | null) => {\n      if (!files || files.length === 0) return;\n\n      const fileArray = Array.from(files);\n      const validFiles: File[] = [];\n      const newErrors: Record<string, string> = {};\n\n      fileArray.forEach((file) => {\n        const error = validateFile(file);\n        if (error) {\n          newErrors[file.name] = error;\n        } else {\n          validFiles.push(file);\n        }\n      });\n\n      if (Object.keys(newErrors).length > 0) {\n        setErrors(newErrors);\n      }\n\n      if (validFiles.length > 0) {\n        const remainingSlots = maxFiles - uploadedFiles.length;\n        const filesToAdd = validFiles.slice(0, remainingSlots);\n\n        if (filesToAdd.length < validFiles.length) {\n          const skipped = validFiles.length - filesToAdd.length;\n          newErrors[\"_general\"] =\n            `${skipped} file${skipped !== 1 ? \"s\" : \"\"} skipped. Maximum ${maxFiles} files allowed.`;\n        }\n\n        onFilesSelected?.(filesToAdd);\n      }\n\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    },\n    [maxFiles, uploadedFiles.length, onFilesSelected, validateFile]\n  );\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n  }, []);\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setIsDragging(false);\n\n      if (uploadedFiles.length >= maxFiles) {\n        setErrors({\n          _general: `Maximum ${maxFiles} files allowed`,\n        });\n        return;\n      }\n\n      handleFiles(e.dataTransfer.files);\n    },\n    [handleFiles, maxFiles, uploadedFiles.length]\n  );\n\n  const handleFileInputChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      handleFiles(e.target.files);\n    },\n    [handleFiles]\n  );\n\n  const handleClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const canAddMore = uploadedFiles.length < maxFiles;\n\n  return (\n    <Card className={cn(\"w-full shadow-xs\", className)}>\n      <CardHeader>\n        <div className=\"flex flex-col gap-1\">\n          <CardTitle>Upload Files</CardTitle>\n          <CardDescription>\n            Upload images, documents, or code files for AI analysis\n          </CardDescription>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col gap-4\">\n          {canAddMore && (\n            <div\n              className={cn(\n                \"flex cursor-pointer flex-col items-center justify-center gap-4 rounded-lg border-2 border-dashed p-8 transition-colors\",\n                isDragging\n                  ? \"border-primary bg-primary/5\"\n                  : \"border-muted bg-muted/30 hover:border-primary/50\"\n              )}\n              onClick={handleClick}\n              onDragLeave={handleDragLeave}\n              onDragOver={handleDragOver}\n              onDrop={handleDrop}\n            >\n              <div className=\"flex size-12 items-center justify-center rounded-full bg-primary/10\">\n                <Upload className=\"size-6 text-primary\" />\n              </div>\n              <div className=\"flex flex-col gap-2 text-center\">\n                <p className=\"font-medium text-sm\">\n                  Drag and drop files here, or{\" \"}\n                  <span className=\"text-primary underline\">\n                    click to browse\n                  </span>\n                </p>\n                <p className=\"text-muted-foreground text-xs\">\n                  Accepted: {acceptedTypes.join(\", \")}\n                  {maxSize && ` • Max size: ${formatFileSize(maxSize)}`}\n                  {maxFiles && ` • Max files: ${maxFiles}`}\n                </p>\n              </div>\n              <input\n                accept={acceptedTypes.join(\",\")}\n                className=\"hidden\"\n                multiple={maxFiles > 1}\n                onChange={handleFileInputChange}\n                ref={fileInputRef}\n                type=\"file\"\n              />\n            </div>\n          )}\n\n          {errors._general && (\n            <div className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-3\">\n              <p className=\"text-destructive text-sm\">{errors._general}</p>\n            </div>\n          )}\n\n          {uploadedFiles.length > 0 && (\n            <div className=\"flex flex-col gap-3\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"font-medium text-sm\">\n                  Uploaded Files ({uploadedFiles.length}\n                  {maxFiles && ` / ${maxFiles}`})\n                </h3>\n                {canAddMore && (\n                  <Button\n                    onClick={handleClick}\n                    size=\"sm\"\n                    type=\"button\"\n                    variant=\"outline\"\n                  >\n                    <Upload className=\"size-4\" />\n                    Add More\n                  </Button>\n                )}\n              </div>\n              <div className=\"flex flex-col gap-2\">\n                {uploadedFiles.map((uploadedFile) => {\n                  const Icon = getFileIcon(uploadedFile.file.type);\n                  const status =\n                    processingStatus?.[uploadedFile.id] || uploadedFile.status;\n                  const fileError =\n                    errors[uploadedFile.file.name] || uploadedFile.error;\n\n                  return (\n                    <div\n                      className=\"flex flex-col gap-2 rounded-lg border bg-card p-3\"\n                      key={uploadedFile.id}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        {showPreview &&\n                        uploadedFile.preview &&\n                        uploadedFile.file.type.startsWith(\"image/\") ? (\n                          <Image\n                            alt={uploadedFile.file.name}\n                            className=\"size-12 shrink-0 rounded-md object-cover\"\n                            height={48}\n                            src={uploadedFile.preview}\n                            unoptimized\n                            width={48}\n                          />\n                        ) : (\n                          <div className=\"flex size-12 shrink-0 items-center justify-center rounded-md bg-muted\">\n                            <Icon className=\"size-6 text-muted-foreground\" />\n                          </div>\n                        )}\n                        <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n                          <div className=\"flex items-center justify-between gap-2\">\n                            <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n                              <p className=\"wrap-break-word font-medium text-sm\">\n                                {uploadedFile.file.name}\n                              </p>\n                              <div className=\"flex flex-wrap items-center gap-2 text-muted-foreground text-xs\">\n                                <span>\n                                  {getFileTypeLabel(uploadedFile.file.type)}\n                                </span>\n                                <span aria-hidden=\"true\">•</span>\n                                <span>\n                                  {formatFileSize(uploadedFile.file.size)}\n                                </span>\n                              </div>\n                            </div>\n                            <div className=\"flex shrink-0 items-center gap-2\">\n                              {status === \"uploading\" && (\n                                <Loader2 className=\"size-4 animate-spin text-muted-foreground\" />\n                              )}\n                              {status === \"completed\" && (\n                                <Check className=\"size-4 text-green-600\" />\n                              )}\n                              {status === \"error\" && (\n                                <X className=\"size-4 text-destructive\" />\n                              )}\n                              {onFileRemove && (\n                                <Button\n                                  aria-label={`Remove ${uploadedFile.file.name}`}\n                                  onClick={() => onFileRemove(uploadedFile.id)}\n                                  size=\"icon\"\n                                  type=\"button\"\n                                  variant=\"ghost\"\n                                >\n                                  <X className=\"size-4\" />\n                                </Button>\n                              )}\n                            </div>\n                          </div>\n                          {uploadedFile.progress !== undefined &&\n                            status === \"uploading\" && (\n                              <Progress\n                                aria-label={`Upload progress for ${uploadedFile.file.name}`}\n                                className=\"h-1.5\"\n                                value={uploadedFile.progress}\n                              />\n                            )}\n                          {fileError && (\n                            <p className=\"text-destructive text-xs\">\n                              {fileError}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {uploadedFiles.length === 0 && !canAddMore && (\n            <div className=\"flex flex-col items-center justify-center gap-4 py-12 text-center\">\n              <div className=\"flex size-12 items-center justify-center rounded-full bg-muted\">\n                <File className=\"size-6 text-muted-foreground\" />\n              </div>\n              <p className=\"text-muted-foreground text-sm\">\n                Maximum files reached ({maxFiles})\n              </p>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}
