{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ai-conversation",
  "type": "registry:ui",
  "title": "AI Conversation",
  "description": "Display AI conversation messages with streaming support.",
  "registryDependencies": ["ai-message", "ai-thinking"],
  "files": [
    {
      "path": "registry/new-york/blocks/ai/ai-conversation.tsx",
      "content": "\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport AIMessage from \"./ai-message\";\nimport AIThinking from \"./ai-thinking\";\n\nexport interface Message {\n  id: string;\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp?: Date;\n}\n\ninterface AIConversationProps {\n  messages?: Message[];\n  isThinking?: boolean;\n  isStreaming?: boolean;\n  onRegenerate?: (messageId: string) => void;\n  onEdit?: (messageId: string) => void;\n  className?: string;\n  maxHeight?: string;\n}\n\nfunction useAutoScroll(\n  messages: Message[],\n  isThinking: boolean,\n  isStreaming: boolean\n) {\n  const viewportRef = useRef<HTMLDivElement>(null);\n  const shouldScrollRef = useRef(true);\n\n  useEffect(() => {\n    if (!viewportRef.current) return;\n\n    const container = viewportRef.current;\n    const isAtBottom =\n      container.scrollHeight - container.scrollTop <=\n      container.clientHeight + 100;\n\n    shouldScrollRef.current = isAtBottom;\n  }, [messages]);\n\n  useEffect(() => {\n    if (!(viewportRef.current && shouldScrollRef.current)) return;\n\n    if (typeof window !== \"undefined\") {\n      const prefersReducedMotion = window.matchMedia(\n        \"(prefers-reduced-motion: reduce)\"\n      ).matches;\n\n      const scrollBehavior = prefersReducedMotion ? \"auto\" : \"smooth\";\n      viewportRef.current.scrollTo({\n        top: viewportRef.current.scrollHeight,\n        behavior: scrollBehavior,\n      });\n    } else {\n      viewportRef.current.scrollTop = viewportRef.current.scrollHeight;\n    }\n  }, [messages, isThinking, isStreaming]);\n\n  return viewportRef;\n}\n\ninterface UserMessageProps {\n  content: string;\n}\n\nfunction UserMessage({ content }: UserMessageProps) {\n  return (\n    <div className=\"flex justify-end\">\n      <div className=\"max-w-[80%] rounded-lg rounded-tr-none bg-primary px-4 py-2 text-primary-foreground\">\n        <p className=\"wrap-break-word whitespace-pre-wrap text-sm\">{content}</p>\n      </div>\n    </div>\n  );\n}\n\ninterface MessageListProps {\n  messages: Message[];\n  isStreaming: boolean;\n  onRegenerate?: (messageId: string) => void;\n  onEdit?: (messageId: string) => void;\n}\n\nfunction MessageList({\n  messages,\n  isStreaming,\n  onRegenerate,\n  onEdit,\n}: MessageListProps) {\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex flex-1 items-center justify-center p-8\">\n        <p className=\"text-center text-muted-foreground text-sm\">\n          Start a conversation by typing a message below.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-6 p-4\">\n      {messages.map((message, index) => {\n        const isLastMessage = index === messages.length - 1;\n        const isLastAI = isLastMessage && message.role === \"assistant\";\n\n        if (message.role === \"user\") {\n          return <UserMessage content={message.content} key={message.id} />;\n        }\n\n        return (\n          <div className=\"rounded-lg border bg-card p-6\" key={message.id}>\n            <AIMessage\n              className=\"shadow-none\"\n              content={message.content}\n              isStreaming={isStreaming && isLastAI}\n              onEdit={onEdit ? () => onEdit(message.id) : undefined}\n              onRegenerate={\n                onRegenerate ? () => onRegenerate(message.id) : undefined\n              }\n            />\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default function AIConversation({\n  messages: initialMessages = [],\n  isThinking = false,\n  isStreaming = false,\n  onRegenerate,\n  onEdit,\n  className,\n  maxHeight = \"600px\",\n}: AIConversationProps) {\n  const [messages, setMessages] = useState<Message[]>(() => initialMessages);\n  const scrollRef = useAutoScroll(messages, isThinking, isStreaming);\n  const prevInitialMessagesRef = useRef(initialMessages);\n\n  useEffect(() => {\n    if (\n      prevInitialMessagesRef.current !== initialMessages &&\n      initialMessages.length > 0\n    ) {\n      prevInitialMessagesRef.current = initialMessages;\n      const timeoutId = setTimeout(() => {\n        setMessages(initialMessages);\n      }, 0);\n      return () => clearTimeout(timeoutId);\n    }\n  }, [initialMessages]);\n\n  return (\n    <div\n      className={cn(\n        \"flex flex-col overflow-hidden rounded-xl border bg-background shadow-xs\",\n        className\n      )}\n    >\n      <div\n        className=\"flex-1 overflow-y-auto\"\n        ref={scrollRef}\n        style={{ maxHeight }}\n      >\n        <MessageList\n          isStreaming={isStreaming}\n          messages={messages}\n          onEdit={onEdit}\n          onRegenerate={onRegenerate}\n        />\n        {isThinking && (\n          <div className=\"px-4 pb-4\">\n            <AIThinking />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:ui"
    }
  ]
}
